<?php
session_start();

$ADMIN_USERNAME = 'admin';
$ADMIN_PASSWORD = 'admin123';
$UPLOAD_DIR = 'uploads/';
$ANNOUNCEMENT_FILE = 'announcement.json';
$CONFIG_FILE = 'config.json';
$FEATURES_FILE = 'features.json';

$LANG = [
    'vi' => [
        'lang_vi' => 'Tiếng Việt',
        'lang_en' => 'English',
        'admin_panel' => 'Admin Panel',
        'home' => 'Trang chủ',
        'contact' => 'Liên hệ',
        'email_contact' => 'hieu2972009@gmail.com',
        'user_name' => 'Trung Hiếu Nguyễn',
        'copyright' => '© %s HnTech. All rights reserved.',
        'activate_windows' => 'Activate Windows - Go to Settings to activate Windows.',
        'confirm_download_title' => 'Xác nhận tải xuống',
        'confirm_download_body' => 'Bạn có chắc chắn muốn tải:',
        'confirm_download_note' => 'Làm vì mục đích giáo dục',
        'confirm_download_yes' => 'Tải xuống',
        'confirm_download_cancel' => 'Hủy bỏ',

        'login_title' => 'Đăng nhập Admin',
        'login_header' => 'Admin Login',
        'login_username' => 'Tài khoản',
        'login_password' => 'Mật khẩu',
        'login_button' => 'Đăng nhập',
        'login_error' => 'Tên đăng nhập hoặc mật khẩu không chính xác!',

        'admin_title' => 'Admin Panel - HnTech',
        'admin_logout' => 'Đăng xuất',
        'admin_nav_dashboard' => 'Dashboard',
        'admin_nav_announcement' => 'Quản Lý Thông Báo',
        'admin_nav_products' => 'Quản Lý Sản Phẩm',
        'admin_nav_files' => 'Quản Lý File',
        'admin_nav_settings' => 'Cài Đặt',
        'admin_dashboard_welcome' => 'Chào mừng trở lại, Admin!',
        'admin_dashboard_desc' => 'Quản lý website của bạn từ đây.',
        'admin_announcement_header' => 'Quản Lý Thông Báo',
        'admin_announcement_status' => 'Trạng thái',
        'admin_announcement_status_on' => 'Bật',
        'admin_announcement_status_off' => 'Tắt',
        'admin_announcement_content' => 'Nội dung thông báo (hỗ trợ HTML)',
        'admin_announcement_image' => 'Link ảnh (tùy chọn)',
        'admin_announcement_image_placeholder' => 'https://example.com/image.png',
        'admin_announcement_save' => 'Lưu Thông Báo',
        'admin_announcement_success' => 'Đã lưu thông báo thành công!',
        'admin_products_header' => 'Quản Lý Tính Năng Sản Phẩm',
        'admin_products_select' => 'Chọn sản phẩm để sửa',
        'admin_products_select_placeholder' => '-- Chọn sản phẩm --',
        'admin_products_features_vi' => 'Tính Năng (Tiếng Việt)',
        'admin_products_features_en' => 'Tính Năng (English)',
        'admin_products_feature_1' => 'Tính năng 1',
        'admin_products_feature_2' => 'Tính năng 2',
        'admin_products_feature_3' => 'Tính năng 3',
        'admin_products_feature_4' => 'Tính năng 4',
        'admin_products_save' => 'Lưu Sản Phẩm',
        'admin_products_success' => 'Đã lưu tính năng cho %s!',
        'admin_files_upload_header' => 'Tải File Lên Sản Phẩm',
        'admin_files_upload_product' => 'Chọn sản phẩm',
        'admin_files_upload_product_placeholder' => '-- Chọn sản phẩm --',
        'admin_files_upload_file' => 'Chọn file',
        'admin_files_upload_button' => 'Tải Lên',
        'admin_files_upload_success' => 'File đã được tải lên %s thành công!',
        'admin_files_upload_error' => 'Đã xảy ra lỗi khi tải file lên.',
        'admin_files_manage_header' => 'Quản Lý Files Hiện Có',
        'admin_files_empty' => 'Chưa có file nào',
        'admin_files_dir_error' => 'Thư mục chưa tồn tại',
        'admin_files_delete_confirm' => 'Bạn có chắc chắn muốn xóa file này?',
        'admin_files_delete_success' => 'Đã xóa file %s thành công!',
        'admin_settings_header' => 'Cài Đặt Website',
        'admin_settings_contact_link' => 'Link Liên Hệ (Telegram/Zalo)',
        'admin_settings_contact_link_placeholder' => 'https://t.me/Thunguyet2404',
        'admin_settings_save' => 'Lưu Cài Đặt',
        'admin_settings_success' => 'Đã lưu cài đặt thành công!',

        'main_title' => 'HnTech',
        'main_subtitle' => 'Công nghệ gaming tiên tiến',
        'product_features' => 'Tính Năng',
        'product_pricing' => 'Bảng Giá & Tải Về',
        'product_pricing_table_header_package' => 'Gói',
        'product_pricing_table_header_price' => 'Giá',
        'product_download_header' => 'Files Tải Về',
        'product_download_button' => 'Tải xuống file %s',
        'product_download_contact' => 'Liên Hệ Để Tải',
        'product_contact_prompt' => 'Liên hệ để tải về và nhận hỗ trợ',
        'product_contact_button' => 'Liên Hệ Ngay',

        'nav_aimbot' => 'Aimbot',
        'nav_anticheat' => 'Anticheat',
        'nav_bypass' => 'Bypass',
        'nav_fixlag' => 'Fixlag',
        'aimbot_safe_title' => 'Aimbot (Safe)',
        'aimbot_safe_desc' => 'Dịch vụ aimbot an toàn, hiệu quả, leo rank nhanh chóng.',
        'aimbot_safe_p1' => 'Gói 1 ngày',
        'aimbot_safe_p2' => 'Gói 7 ngày',
        'aimbot_safe_p3' => 'Gói 30 ngày',
        'aimbot_silent_title' => 'Aimbot (Silent Aim)',
        'aimbot_silent_desc' => 'Công nghệ silent aim, không bị phát hiện, hoàn hảo cho streaming.',
        'aimbot_silent_p1' => 'Gói 1 ngày',
        'aimbot_silent_p2' => 'Gói 7 ngày',
        'aimbot_silent_p3' => 'Gói 30 ngày',
        'anticheat_title' => 'Anticheat',
        'anticheat_desc' => 'Hệ thống chống phát hiện tiên tiến cho mọi loại tool.',
        'anticheat_p1' => 'Gói 1 ngày',
        'anticheat_p2' => 'Gói 7 ngày',
        'anticheat_p3' => 'Gói 30 ngày',
        'bypass_title' => 'Bypass Guardian',
        'bypass_desc' => 'Vượt qua mọi rào cản, ẩn hoàn toàn giả lập, ghép trận mobile.',
        'bypass_p1' => 'Gói 1 ngày',
        'bypass_p2' => 'Gói 7 ngày',
        'bypass_p3' => 'Gói 30 ngày',
        'fixlag_title' => 'Fixlag',
        'fixlag_desc' => 'Dịch vụ tối ưu hóa hệ thống chuyên sâu, fix lag, tăng FPS',
        'fixlag_p1' => 'Gói tối ưu',
        'fixlag_p2' => 'Giả lập tinh chỉnh',

        'modal_dismiss_2h' => 'Tắt trong 2 tiếng',
        'modal_close' => 'Đóng',
    ],
    'en' => [
        'lang_vi' => 'Tiếng Việt',
        'lang_en' => 'English',
        'admin_panel' => 'Admin Panel',
        'home' => 'Home',
        'contact' => 'Contact',
        'email_contact' => 'hieu2972009@gmail.com',
        'user_name' => 'Trung Hieu Nguyen',
        'copyright' => '© %s HnTech. All rights reserved.',
        'activate_windows' => 'Activate Windows - Go to Settings to activate Windows.',
        'confirm_download_title' => 'Confirm Download',
        'confirm_download_body' => 'Are you sure you want to download:',
        'confirm_download_note' => 'Made for education purposes',
        'confirm_download_yes' => 'Download',
        'confirm_download_cancel' => 'Cancel',

        'login_title' => 'Admin Login',
        'login_header' => 'Admin Login',
        'login_username' => 'Username',
        'login_password' => 'Password',
        'login_button' => 'Login',
        'login_error' => 'Incorrect username or password!',

        'admin_title' => 'Admin Panel - HnTech',
        'admin_logout' => 'Logout',
        'admin_nav_dashboard' => 'Dashboard',
        'admin_nav_announcement' => 'Manage Announcement',
        'admin_nav_products' => 'Manage Products',
        'admin_nav_files' => 'File Management',
        'admin_nav_settings' => 'Settings',
        'admin_dashboard_welcome' => 'Welcome back, Admin!',
        'admin_dashboard_desc' => 'Manage your website from here.',
        'admin_announcement_header' => 'Manage Announcement',
        'admin_announcement_status' => 'Status',
        'admin_announcement_status_on' => 'On',
        'admin_announcement_status_off' => 'Off',
        'admin_announcement_content' => 'Announcement content (HTML supported)',
        'admin_announcement_image' => 'Image URL (optional)',
        'admin_announcement_image_placeholder' => 'https://example.com/image.png',
        'admin_announcement_save' => 'Save Announcement',
        'admin_announcement_success' => 'Announcement saved successfully!',
        'admin_products_header' => 'Manage Product Features',
        'admin_products_select' => 'Select product to edit',
        'admin_products_select_placeholder' => '-- Select product --',
        'admin_products_features_vi' => 'Features (Tiếng Việt)',
        'admin_products_features_en' => 'Features (English)',
        'admin_products_feature_1' => 'Feature 1',
        'admin_products_feature_2' => 'Feature 2',
        'admin_products_feature_3' => 'Feature 3',
        'admin_products_feature_4' => 'Feature 4',
        'admin_products_save' => 'Save Product',
        'admin_products_success' => 'Features for %s saved!',
        'admin_files_upload_header' => 'Upload File to Product',
        'admin_files_upload_product' => 'Select product',
        'admin_files_upload_product_placeholder' => '-- Select product --',
        'admin_files_upload_file' => 'Select file',
        'admin_files_upload_button' => 'Upload',
        'admin_files_upload_success' => 'File successfully uploaded to %s!',
        'admin_files_upload_error' => 'An error occurred while uploading the file.',
        'admin_files_manage_header' => 'Manage Existing Files',
        'admin_files_empty' => 'No files yet',
        'admin_files_dir_error' => 'Directory does not exist',
        'admin_files_delete_confirm' => 'Are you sure you want to delete this file?',
        'admin_files_delete_success' => 'File %s has been deleted!',
        'admin_settings_header' => 'Website Settings',
        'admin_settings_contact_link' => 'Contact Link (Telegram/Zalo)',
        'admin_settings_contact_link_placeholder' => 'https://t.me/your_username',
        'admin_settings_save' => 'Save Settings',
        'admin_settings_success' => 'Settings saved successfully!',

        'main_title' => 'HnTech',
        'main_subtitle' => 'Advanced Gaming Technology',
        'product_features' => 'Features',
        'product_pricing' => 'Pricing & Download',
        'product_pricing_table_header_package' => 'Package',
        'product_pricing_table_header_price' => 'Price',
        'product_download_header' => 'Download Files',
        'product_download_button' => 'Download file %s',
        'product_download_contact' => 'Contact to Download',
        'product_contact_prompt' => 'Contact us for download and support',
        'product_contact_button' => 'Contact Now',
        
        'nav_aimbot' => 'Aimbot',
        'nav_anticheat' => 'Anticheat',
        'nav_bypass' => 'Bypass',
        'nav_fixlag' => 'Fixlag',
        'aimbot_safe_title' => 'Aimbot (Safe)',
        'aimbot_safe_desc' => 'Safe and effective aimbot service for fast ranking.',
        'aimbot_safe_p1' => '1 Day Package',
        'aimbot_safe_p2' => '7 Day Package',
        'aimbot_safe_p3' => '30 Day Package',
        'aimbot_silent_title' => 'Aimbot (Silent Aim)',
        'aimbot_silent_desc' => 'Undetectable silent aim technology, perfect for streaming.',
        'aimbot_silent_p1' => '1 Day Package',
        'aimbot_silent_p2' => '7 Day Package',
        'aimbot_silent_p3' => '30 Day Package',
        'anticheat_title' => 'Anticheat',
        'anticheat_desc' => 'Advanced anti-detection system for all types of tools.',
        'anticheat_p1' => '1 Day Package',
        'anticheat_p2' => '7 Day Package',
        'anticheat_p3' => '30 Day Package',
        'bypass_title' => 'Bypass Guardian',
        'bypass_desc' => 'Bypass all barriers, completely hide emulators, match with mobile players.',
        'bypass_p1' => '1 Day Package',
        'bypass_p2' => '7 Day Package',
        'bypass_p3' => '30 Day Package',
        'fixlag_title' => 'Fixlag',
        'fixlag_desc' => 'In-depth system optimization service, fix lag, increase FPS',
        'fixlag_p1' => 'Optimization Package',
        'fixlag_p2' => 'Emulator Tweak',
        
        'modal_dismiss_2h' => 'Dismiss for 2 hours',
        'modal_close' => 'Close',
    ]
];

function get_current_lang() {
    if (isset($_GET['lang']) && ($_GET['lang'] === 'vi' || $_GET['lang'] === 'en')) {
        $_SESSION['lang'] = $_GET['lang'];
    }
    
    if (!isset($_SESSION['lang'])) {
        $_SESSION['lang'] = 'vi';
    }
    
    return $_SESSION['lang'];
}

function t($key) {
    global $LANG;
    $lang = get_current_lang();
    
    if (isset($LANG[$lang][$key])) {
        $args = func_get_args();
        array_shift($args); 
        
        if (count($args) > 0) {
            return vsprintf($LANG[$lang][$key], $args);
        } else {
            return $LANG[$lang][$key];
        }
    } else {
        return $key;
    }
}

$current_lang = get_current_lang();

function get_config() {
    global $CONFIG_FILE;
    $defaults = [
        'contact_link' => 'https://t.me/Thunguyet2404'
    ];
    
    if (file_exists($CONFIG_FILE)) {
        $config = json_decode(file_get_contents($CONFIG_FILE), true);
        return array_merge($defaults, $config);
    }
    return $defaults;
}
$config = get_config(); 

function get_features_data() {
    global $FEATURES_FILE;
    $defaults = [
        'aimbot_safe' => [
            'vi' => ['Aimbot chính xác', 'ESP chuyên nghiệp', 'An toàn, chống ban', 'Hỗ trợ mọi vũ khí'],
            'en' => ['Accurate Aimbot', 'Professional ESP', 'Safe, Anti-ban', 'Supports all weapons']
        ],
        'aimbot_silent' => [
            'vi' => ['Silent aim', 'Không giật (No recoil)', 'Độ chính xác tuyệt đối', 'Hoạt động ngầm'],
            'en' => ['Silent aim', 'No recoil', 'Absolute precision', 'Background operation']
        ],
        'anticheat' => [
            'vi' => ['Chống phát hiện (UD)', 'Bảo vệ an toàn', 'Hoạt động liên tục', 'Tương thích nhiều game'],
            'en' => ['Undetected (UD)', 'Account protection', 'Continuous operation', 'Multi-game compatible']
        ],
        'bypass' => [
            'vi' => ['Vượt rào Guardian', 'Ẩn giả lập', 'Ghép trận mobile', 'An toàn tuyệt đối'],
            'en' => ['Guardian Bypass', 'Hide Emulator', 'Mobile Matchmaking', 'Total Security']
        ],
        'fixlag' => [
            'vi' => ['Fix lag hiệu quả', 'Tăng FPS đáng kể', 'Trải nghiệm mượt mà', 'Tương thích tất cả cấu hình'],
            'en' => ['Effective lag fix', 'Significant FPS boost', 'Smooth experience', 'Compatible with all configs']
        ]
    ];

    if (file_exists($FEATURES_FILE)) {
        $features = json_decode(file_get_contents($FEATURES_FILE), true);
        return array_merge($defaults, $features);
    } else {
        file_put_contents($FEATURES_FILE, json_encode($defaults, JSON_PRETTY_PRINT | JSON_UNESCAPED_UNICODE));
        return $defaults;
    }
}
$features_data = get_features_data(); 

$PRODUCTS = [
    'aimbot_safe' => [
        'name_key' => 'aimbot_safe_title',
        'dir' => 'uploads/aimbot_safe/'
    ],
    'aimbot_silent' => [
        'name_key' => 'aimbot_silent_title',
        'dir' => 'uploads/aimbot_silent/'
    ],
    'anticheat' => [
        'name_key' => 'anticheat_title',
        'dir' => 'uploads/anticheat/'
    ],
    'bypass' => [
        'name_key' => 'bypass_title',
        'dir' => 'uploads/bypass/'
    ],
    'fixlag' => [
        'name_key' => 'fixlag_title',
        'dir' => 'uploads/fixlag/'
    ]
];

$PRODUCT_DETAILS = [
    'aimbot_safe' => [
        'nav_key' => 'nav_aimbot',
        'title_key' => 'aimbot_safe_title',
        'description_key' => 'aimbot_safe_desc',
        'pricing' => [
            ['name_key' => 'aimbot_safe_p1', 'price' => '25.000 VND'],
            ['name_key' => 'aimbot_safe_p2', 'price' => '120.000 VND'],
            ['name_key' => 'aimbot_safe_p3', 'price' => '350.000 VND']
        ],
    ],
    'aimbot_silent' => [
        'nav_key' => 'nav_aimbot',
        'title_key' => 'aimbot_silent_title',
        'description_key' => 'aimbot_silent_desc',
        'pricing' => [
            ['name_key' => 'aimbot_silent_p1', 'price' => '30.000 VND'],
            ['name_key' => 'aimbot_silent_p2', 'price' => '150.000 VND'],
            ['name_key' => 'aimbot_silent_p3', 'price' => '400.000 VND']
        ],
    ],
    'anticheat' => [
        'nav_key' => 'nav_anticheat',
        'title_key' => 'anticheat_title',
        'description_key' => 'anticheat_desc',
        'pricing' => [
            ['name_key' => 'anticheat_p1', 'price' => '35.000 VND'],
            ['name_key' => 'anticheat_p2', 'price' => '180.000 VND'],
            ['name_key' => 'anticheat_p3', 'price' => '450.000 VND']
        ],
    ],
    'bypass' => [
        'nav_key' => 'nav_bypass',
        'title_key' => 'bypass_title',
        'description_key' => 'bypass_desc',
        'pricing' => [
            ['name_key' => 'bypass_p1', 'price' => '20.000 VND'],
            ['name_key' => 'bypass_p2', 'price' => '100.000 VND'],
            ['name_key' => 'bypass_p3', 'price' => '300.000 VND']
        ],
    ],
    'fixlag' => [
        'nav_key' => 'nav_fixlag',
        'title_key' => 'fixlag_title',
        'description_key' => 'fixlag_desc',
        'pricing' => [
            ['name_key' => 'fixlag_p1', 'price' => '99.000 VND'],
            ['name_key' => 'fixlag_p2', 'price' => 'Miễn phí']
        ],
    ]
];

$page = isset($_GET['page']) ? $_GET['page'] : 'home';
$login_error = ''; 
$admin_message = ''; 

if ($page === 'login' && $_SERVER['REQUEST_METHOD'] === 'POST') {
    if (isset($_POST['username']) && isset($_POST['password'])) {
        if ($_POST['username'] === $ADMIN_USERNAME && $_POST['password'] === $ADMIN_PASSWORD) {
            $_SESSION['loggedin'] = true;
            header('Location: ?page=admin');
            exit;
        } else {
            $login_error = t('login_error');
        }
    }
}

if ($page === 'logout') {
    session_destroy();
    header('Location: ?page=login');
    exit;
}

if ($page === 'admin') {
    if (!isset($_SESSION['loggedin']) || $_SESSION['loggedin'] !== true) {
        header('Location: ?page=login');
        exit;
    }

    foreach ($PRODUCTS as $product) {
        if (!file_exists($product['dir'])) {
            mkdir($product['dir'], 0777, true);
        }
    }
    
    if (isset($_POST['save_settings'])) {
        $new_config = get_config(); 
        $new_config['contact_link'] = $_POST['contact_link'] ?? 'https://t.me/Thunguyet2404';
        
        file_put_contents($CONFIG_FILE, json_encode($new_config, JSON_PRETTY_PRINT | JSON_UNESCAPED_UNICODE));
        $admin_message = '<p class="success">' . t('admin_settings_success') . '</p>';
    }

    if (isset($_POST['save_features'])) {
        $product_key = $_POST['product_key'];
        if (isset($features_data[$product_key])) {
            $new_features = get_features_data(); 
            
            $new_features[$product_key]['vi'][0] = $_POST['feature_vi_1'] ?? '';
            $new_features[$product_key]['vi'][1] = $_POST['feature_vi_2'] ?? '';
            $new_features[$product_key]['vi'][2] = $_POST['feature_vi_3'] ?? '';
            $new_features[$product_key]['vi'][3] = $_POST['feature_vi_4'] ?? '';
            
            $new_features[$product_key]['en'][0] = $_POST['feature_en_1'] ?? '';
            $new_features[$product_key]['en'][1] = $_POST['feature_en_2'] ?? '';
            $new_features[$product_key]['en'][2] = $_POST['feature_en_3'] ?? '';
            $new_features[$product_key]['en'][3] = $_POST['feature_en_4'] ?? '';
            
            file_put_contents($FEATURES_FILE, json_encode($new_features, JSON_PRETTY_PRINT | JSON_UNESCAPED_UNICODE));
            $admin_message = '<p class="success">' . t('admin_products_success', t($PRODUCTS[$product_key]['name_key'])) . '</p>';
            $features_data = $new_features;
        }
    }

    if (isset($_POST['save_announcement'])) {
        $announcement_data = [
            'status' => $_POST['status'] ?? 'off',
            'content' => $_POST['content'] ?? '',
            'image_url' => $_POST['image_url'] ?? ''
        ];
        file_put_contents($ANNOUNCEMENT_FILE, json_encode($announcement_data, JSON_PRETTY_PRINT | JSON_UNESCAPED_UNICODE));
        $admin_message = '<p class="success">' . t('admin_announcement_success') . '</p>';
    }

    if ($_SERVER['REQUEST_METHOD'] === 'POST' && isset($_FILES['fileToUpload']) && isset($_POST['product_type'])) {
        $product_type = $_POST['product_type'];
        if (isset($PRODUCTS[$product_type])) {
            $target_dir = $PRODUCTS[$product_type]['dir'];
            $target_file = $target_dir . basename($_FILES['fileToUpload']['name']);
            if (move_uploaded_file($_FILES['fileToUpload']['tmp_name'], $target_file)) {
                $admin_message = '<p class="success">' . t('admin_upload_success', t($PRODUCTS[$product_type]['name_key'])) . '</p>';
            } else {
                $admin_message = '<p class="error">' . t('admin_upload_error') . '</p>';
            }
        }
    }

    if (isset($_GET['delete']) && isset($_GET['product'])) {
        $product_type = $_GET['product'];
        if (isset($PRODUCTS[$product_type])) {
            $file_to_delete = $PRODUCTS[$product_type]['dir'] . basename($_GET['delete']);
            if (file_exists($file_to_delete) && is_file($file_to_delete)) {
                unlink($file_to_delete);
                $message = t('admin_files_delete_success', htmlspecialchars(basename($_GET['delete'])));
                
                if (isset($_GET['ajax'])) {
                    header('Content-Type: application/json');
                    echo json_encode(['status' => 'success', 'message' => $message]);
                    exit;
                } else {
                    $admin_message = '<p class="success">' . $message . '</p>';
                    $current_section = isset($_GET['section']) ? '&section=' . $_GET['section'] : '';
                    header('Location: ?page=admin&section=files&tab=manage');
                    exit;
                }
            }
        }
    }
}

function display_page_header($title) {
    $current_lang = get_current_lang();
    
    $query_params_vi = array_merge($_GET, ['lang' => 'vi']);
    $query_params_en = array_merge($_GET, ['lang' => 'en']);
    
    $vi_link = '?' . http_build_query($query_params_vi);
    $en_link = '?' . http_build_query($query_params_en);
    
?>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title><?php echo $title; ?></title>
    <link href="https://fonts.googleapis.com/css2?family=Be+Vietnam+Pro:wght@300;400;500;700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        .lang-switcher {
            position: absolute;
            top: 15px;
            right: 20px;
            z-index: 110;
        }
        .lang-switcher select {
            background-color: #21262d;
            color: #c9d1d9;
            border: 1px solid #30363d;
            border-radius: 6px;
            padding: 5px 8px;
            font-family: 'Be Vietnam Pro', sans-serif;
            font-weight: 500;
        }
        .admin-header .lang-switcher {
            position: relative;
            top: 0;
            right: 0;
        }
    </style>
</head>
<body class="<?php echo (isset($_GET['page']) && $_GET['page'] === 'admin') ? 'admin-body' : ''; ?>">
    <div class="lang-switcher">
        <select onchange="window.location.href = this.value;">
            <option value="<?php echo $vi_link; ?>" <?php echo $current_lang === 'vi' ? 'selected' : ''; ?>><?php echo t('lang_vi'); ?></option>
            <option value="<?php echo $en_link; ?>" <?php echo $current_lang === 'en' ? 'selected' : ''; ?>><?php echo t('lang_en'); ?></option>
        </select>
    </div>
<?php
}

function display_login_page($error = '') {
    display_page_header(t('login_title'));
?>
    <style>
        :root { --background: #0d1117; --surface: #161b22; --surface-light: #21262d; --primary: #00aaff; --text: #c9d1d9; --text-secondary: #8b949e; --border: #30363d; }
        body { font-family: 'Be Vietnam Pro', sans-serif; background-color: var(--background); color: var(--text); display: flex; justify-content: center; align-items: center; height: 100vh; margin: 0; overflow: hidden; }
        .star { position: absolute; width: 10px; height: 10px; background: white; clip-path: polygon(50% 0%, 61% 35%, 98% 35%, 68% 57%, 79% 91%, 50% 70%, 21% 91%, 32% 57%, 2% 35%, 39% 35%); opacity: 0.7; animation: fall linear infinite; z-index: -1;}
        @keyframes fall { to { transform: translateY(100vh) rotate(360deg); opacity: 0; } }
        .login-container { background-color: var(--surface); padding: 40px; border-radius: 10px; box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5); width: 320px; border: 1px solid var(--border); z-index: 10; }
        h1 { text-align: center; color: var(--primary); margin-bottom: 20px; }
        .input-group { margin-bottom: 20px; }
        label { display: block; margin-bottom: 5px; color: var(--text-secondary); }
        input[type="text"], input[type="password"] { width: 100%; padding: 10px; border: 1px solid var(--border); background-color: var(--surface-light); color: var(--text); border-radius: 5px; box-sizing: border-box; }
        input[type="submit"] { width: 100%; padding: 12px; background-color: var(--primary); color: #fff; border: none; border-radius: 5px; cursor: pointer; font-weight: bold; font-size: 16px; transition: background-color 0.3s; }
        input[type="submit"]:hover { background-color: #0088cc; }
        .error { color: #cf6679; text-align: center; margin-top: 15px; }
        .lang-switcher { top: 20px; right: 20px; }
    </style>

    <div class="login-container">
        <h1><?php echo t('login_header'); ?></h1>
        <form method="post">
            <div class="input-group">
                <label for="username"><?php echo t('login_username'); ?></label>
                <input type="text" id="username" name="username" required>
            </div>
            <div class="input-group">
                <label for="password"><?php echo t('login_password'); ?></label>
                <input type="password" id="password" name="password" required>
            </div>
            <input type="submit" value="<?php echo t('login_button'); ?>">
            <?php if ($error): ?>
                <p class="error"><?php echo $error; ?></p>
            <?php endif; ?>
        </form>
    </div>
    <script>
        for(let i = 0; i < 30; i++) {
            let star = document.createElement('div');
            star.className = 'star';
            star.style.left = Math.random() * 100 + '%';
            star.style.animationDuration = (Math.random() * 5 + 8) + 's';
            star.style.animationDelay = Math.random() * 5 + 's';
            document.body.appendChild(star);
        }
    </script>
</body>
</html>
<?php
}

function display_admin_page($admin_message = '', $products = [], $announcement_file = '', $config = [], $features_data = []) {
    
    $announcement_data = ['status' => 'off', 'content' => '', 'image_url' => ''];
    if (file_exists($announcement_file)) {
        $announcement_data = json_decode(file_get_contents($announcement_file), true);
    }
    
    $section = isset($_GET['section']) ? $_GET['section'] : 'dashboard'; 

    display_page_header(t('admin_title'));
?>
    <style>
        :root {
            --background: #000000; 
            --surface: #111111; 
            --surface-light: #191919; 
            --border: #2e2e2e; 
            
            --primary: #00aaff; 
            --text: #e0e0e0; 
            --text-secondary: #888888;
            --red: #cf6679; 
            --green: #28a745;
        }
        html, body.admin-body { 
            background-color: var(--background); 
            color: var(--text);
        }
        body.admin-body { 
            font-family: 'Be Vietnam Pro', sans-serif; 
            margin: 0; padding: 0; overflow-x: hidden; 
        }

        .star { position: fixed; width: 8px; height: 8px; background: white; clip-path: polygon(50% 0%, 61% 35%, 98% 35%, 68% 57%, 79% 91%, 50% 70%, 21% 91%, 32% 57%, 2% 35%, 39% 35%); opacity: 0.4; animation: fall linear infinite; pointer-events: none; z-index: 1; }
        @keyframes fall { to { transform: translateY(100vh) rotate(360deg); opacity: 0; } }
        
        .admin-layout { display: flex; min-height: 100vh; }
        
        .admin-sidebar {
            width: 250px;
            background-color: var(--surface);
            border-right: 1px solid var(--border);
            padding: 20px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.3);
            z-index: 10;
            transition: all 0.3s ease;
        }
        .admin-sidebar h1 {
            color: var(--primary);
            margin: 0 0 30px 0;
            font-size: 1.5rem;
            text-align: center;
            white-space: nowrap;
        }
        .admin-nav { list-style: none; padding: 0; margin: 0; }
        .admin-nav li a {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 8px;
            color: var(--text-secondary);
            text-decoration: none;
            font-weight: 500;
            transition: all 0.3s;
            white-space: nowrap;
        }
        .admin-nav li a:hover {
            background-color: var(--surface-light);
            color: var(--text);
        }
        .admin-nav li a.active {
            background-color: var(--primary);
            color: #fff;
            box-shadow: 0 5px 15px rgba(0, 170, 255, 0.3);
        }
        .admin-nav li a .fa-fw { width: 20px; }
        
        .admin-content {
            flex: 1;
            padding: 30px 40px;
            overflow-x: hidden;
            position: relative; 
            transition: margin-left 0.3s ease;
        }
        
        .admin-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid var(--border);
            padding-bottom: 20px;
            margin-bottom: 30px;
        }
        .admin-header .header-left { display: flex; align-items: center; gap: 20px; }
        .admin-header h2 { color: var(--text); margin: 0; font-size: 1.8rem; }
        
        .admin-header .header-right { display: flex; align-items: center; gap: 20px; }
        .logout-btn { background-color: var(--red); color: #fff; padding: 10px 15px; border-radius: 5px; text-decoration: none; font-weight: bold; transition: background-color 0.3s; }
        .logout-btn:hover { background-color: #b04f5f; }
        
        #sidebar-toggle {
            background: var(--surface-light); border: 1px solid var(--border);
            color: var(--text); font-size: 1.2rem;
            width: 40px; height: 40px; border-radius: 8px;
            cursor: pointer; transition: all 0.3s;
        }
        #sidebar-toggle:hover { background-color: var(--border); color: #fff; }

        body.sidebar-collapsed .admin-sidebar {
            width: 0;
            padding: 20px 0;
            overflow: hidden;
        }
        body.sidebar-collapsed .admin-content {
            margin-left: 0;
        }
        
        .admin-box { background-color: var(--surface-light); padding: 25px; border-radius: 12px; margin-bottom: 30px; border: 1px solid var(--border); }
        .admin-form { display: grid; grid-template-columns: 1fr; gap: 15px; }
        .admin-form.dual-lang { grid-template-columns: 1fr 1fr; gap: 25px; }
        .form-group { display: flex; flex-direction: column; }
        
        label { display: block; margin-bottom: 8px; color: var(--text-secondary); font-weight: 500; }
        select, input[type="file"], input[type="text"], textarea {
            background-color: var(--background); color: var(--text); padding: 12px;
            border-radius: 8px; border: 1px solid var(--border); font-size: 14px;
            width: 100%; box-sizing: border-box;
        }
        textarea { resize: vertical; min-height: 100px; }
        input[type="submit"] {
            background-color: var(--primary); color: #fff; border: none; padding: 12px 30px;
            border-radius: 8px; cursor: pointer; font-weight: bold;
            transition: all 0.3s; justify-self: start; width: auto;
        }
        input[type="submit"]:hover { background-color: #0088cc; transform: translateY(-2px); }
        
        .message { text-align: center; padding: 15px; border-radius: 8px; margin-bottom: 20px; font-weight: 500; }
        .success { background-color: var(--green); color: #fff; }
        .error { background-color: var(--red); color: #fff; }
        
        .tabs { display: flex; gap: 5px; margin-bottom: 20px; border-bottom: 1px solid var(--border); }
        .tab-link {
            padding: 10px 20px; background: var(--surface);
            color: var(--text-secondary); text-decoration: none;
            border-radius: 8px 8px 0 0; border: 1px solid var(--border);
            border-bottom: none; font-weight: 500;
        }
        .tab-link.active {
            background: var(--surface-light);
            color: var(--primary);
            border-color: var(--border);
            position: relative;
            bottom: -1px;
        }
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        
        .products-container { display: grid; grid-template-columns: repeat(auto-fit, minmax(320px, 1fr)); gap: 25px; margin-top: 30px; }
        .product-section { background-color: var(--surface); padding: 25px; border-radius: 12px; border: 1px solid var(--border); transition: all 0.3s; }
        .product-section:hover { box-shadow: 0 5px 15px rgba(0, 170, 255, 0.2); border-color: var(--primary); }
        .product-title { color: var(--primary); font-size: 1.3rem; margin-bottom: 20px; display: flex; align-items: center; gap: 10px; margin-top: 0; }
        
        .file-list { list-style: none; padding: 0; }
        .file-item { background-color: var(--surface-light); padding: 15px; border-radius: 8px; margin-bottom: 10px; display: flex; justify-content: space-between; align-items: center; transition: all 0.2s; border: 1px solid var(--border); }
        .file-item:hover { background-color: rgba(0, 170, 255, 0.1); }
        .file-item a { color: var(--text); text-decoration: none; display: flex; align-items: center; gap: 8px; }
        .file-item a:hover { text-decoration: underline; color: var(--primary); }
        .delete-btn { color: var(--red); text-decoration: none; font-size: 1.2rem; padding: 5px 10px; transition: all 0.2s; cursor: pointer; } 
        .delete-btn:hover { color: #ff4444; transform: scale(1.2); }
        .empty-state { text-align: center; padding: 30px; color: var(--text-secondary); font-style: italic; }
        
        .admin-header .lang-switcher { display: none; }
        .admin-sidebar .lang-switcher {
            position: relative; top: 0; right: 0;
            margin-top: 30px;
        }
        .admin-sidebar .lang-switcher select { width: 100%; background-color: var(--background); } 
        
        @media (max-width: 900px) {
            .admin-layout { flex-direction: column; }
            .admin-sidebar { width: 100%; border-right: none; border-bottom: 1px solid var(--border); }
            .admin-sidebar h1 { display: none; } 
            .admin-nav { display: flex; justify-content: center; flex-wrap: wrap; }
            .admin-nav li a { flex-direction: column; gap: 5px; font-size: 0.8rem; }
            .admin-nav li a .fa-fw { margin-right: 0 !important; }
            #sidebar-toggle { display: none; } 
            body.sidebar-collapsed .admin-sidebar { width: 100%; padding: 20px; } 
            .admin-sidebar .lang-switcher { display: none; } 
            .admin-header .lang-switcher { display: block; } 
            .admin-header .header-right { gap: 10px; }
            .admin-form.dual-lang { grid-template-columns: 1fr; } 
        }
        @media (max-width: 400px) {
            .products-container {
                 grid-template-columns: 1fr; 
            }
            .admin-content {
                padding: 20px 15px; 
            }
        }
    </style>
</head>
<body class="admin-body"> 
    <div class="admin-layout">
        <nav class="admin-sidebar">
            <h1><?php echo t('admin_panel'); ?></h1>
            <ul class="admin-nav">
                <li><a href="?page=admin&section=dashboard" class="<?php echo $section === 'dashboard' ? 'active' : ''; ?>">
                    <i class="fas fa-tachometer-alt fa-fw"></i> <span><?php echo t('admin_nav_dashboard'); ?></span>
                </a></li>
                <li><a href="?page=admin&section=announcement" class="<?php echo $section === 'announcement' ? 'active' : ''; ?>">
                    <i class="fas fa-bell fa-fw"></i> <span><?php echo t('admin_nav_announcement'); ?></span>
                </a></li>
                <li><a href="?page=admin&section=products" class="<?php echo $section === 'products' ? 'active' : ''; ?>">
                    <i class="fas fa-box-open fa-fw"></i> <span><?php echo t('admin_nav_products'); ?></span>
                </a></li>
                <li><a href="?page=admin&section=files" class="<?php echo $section === 'files' ? 'active' : ''; ?>">
                    <i class="fas fa-folder-open fa-fw"></i> <span><?php echo t('admin_nav_files'); ?></span>
                </a></li>
                <li><a href="?page=admin&section=settings" class="<?php echo $section === 'settings' ? 'active' : ''; ?>">
                    <i class="fas fa-cogs fa-fw"></i> <span><?php echo t('admin_nav_settings'); ?></span>
                </a></li>
            </ul>
            <div class="lang-switcher">
                <select onchange="window.location.href = this.value;">
                    <option value="?page=admin&section=<?php echo $section; ?>&lang=vi" <?php echo get_current_lang() === 'vi' ? 'selected' : ''; ?>><?php echo t('lang_vi'); ?></option>
                    <option value="?page=admin&section=<?php echo $section; ?>&lang=en" <?php echo get_current_lang() === 'en' ? 'selected' : ''; ?>><?php echo t('lang_en'); ?></option>
                </select>
            </div>
        </nav>
        
        <main class="admin-content">
            <?php for($i=0; $i<30; $i++) { echo '<div class="star" style="left:'.rand(0,100).'%; animation-duration:'.rand(5,15).'s; animation-delay:'.rand(0,10).'s;"></div>'; } ?>

            <div class="admin-header">
                <div class="header-left">
                    <button id="sidebar-toggle"><i class="fas fa-bars"></i></button>
                    <h2>
                        <?php
                        if ($section === 'dashboard') echo t('admin_nav_dashboard');
                        elseif ($section === 'announcement') echo t('admin_nav_announcement');
                        elseif ($section === 'products') echo t('admin_nav_products');
                        elseif ($section === 'files') echo t('admin_nav_files');
                        elseif ($section === 'settings') echo t('admin_nav_settings');
                        ?>
                    </h2>
                </div>
                <div class="header-right">
                    <div class="lang-switcher">
                        <select onchange="window.location.href = this.value;">
                            <option value="?page=admin&section=<?php echo $section; ?>&lang=vi" <?php echo get_current_lang() === 'vi' ? 'selected' : ''; ?>><?php echo t('lang_vi'); ?></option>
                            <option value="?page=admin&section=<?php echo $section; ?>&lang=en" <?php echo get_current_lang() === 'en' ? 'selected' : ''; ?>><?php echo t('lang_en'); ?></option>
                        </select>
                    </div>
                    <a href="?page=logout" class="logout-btn"><i class="fas fa-sign-out-alt"></i> <?php echo t('admin_logout'); ?></a>
                </div>
            </div>
            
            <?php if ($admin_message) echo $admin_message; ?>
            <div id="dynamic-admin-message"></div>

            <?php if ($section === 'dashboard'): ?>
            <section class="admin-box" id="dashboard">
                <h2><?php echo t('admin_dashboard_welcome'); ?></h2>
                <p><?php echo t('admin_dashboard_desc'); ?></p>
            </section>
            <?php endif; ?>

            <?php if ($section === 'announcement'): ?>
            <section class="admin-box" id="announcement">
                <form method="post" class="admin-form" action="?page=admin&section=announcement">
                    <div class="form-group">
                        <label for="status"><?php echo t('admin_announcement_status'); ?></label>
                        <select name="status" id="status">
                            <option value="on" <?php echo ($announcement_data['status'] === 'on') ? 'selected' : ''; ?>><?php echo t('admin_announcement_status_on'); ?></option>
                            <option value="off" <?php echo ($announcement_data['status'] === 'off') ? 'selected' : ''; ?>><?php echo t('admin_announcement_status_off'); ?></option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="content"><?php echo t('admin_announcement_content'); ?></label>
                        <textarea name="content" id="content" rows="5"><?php echo htmlspecialchars($announcement_data['content']); ?></textarea>
                    </div>
                    <div class="form-group">
                        <label for="image_url"><?php echo t('admin_announcement_image'); ?></label>
                        <input type="text" name="image_url" id="image_url" value="<?php echo htmlspecialchars($announcement_data['image_url']); ?>" placeholder="<?php echo t('admin_announcement_image_placeholder'); ?>">
                    </div>
                    <input type="submit" name="save_announcement" value="<?php echo t('admin_announcement_save'); ?>">
                </form>
            </section>
            <?php endif; ?>

            <?php if ($section === 'products'): 
                $current_product_key = $_GET['product_key'] ?? array_key_first($products);
                $current_features = $features_data[$current_product_key] ?? ['vi' => [], 'en' => []];
            ?>
            <section class="admin-box" id="products">
                <form method="GET" class="admin-form">
                    <input type="hidden" name="page" value="admin">
                    <input type="hidden" name="section" value="products">
                    <div class="form-group">
                        <label for="product_key"><?php echo t('admin_products_select'); ?></label>
                        <select name="product_key" id="product_key" onchange="this.form.submit()">
                            <option value="">-- <?php echo t('admin_products_select_placeholder'); ?> --</option>
                            <?php foreach ($products as $key => $product): ?>
                                <option value="<?php echo $key; ?>" <?php echo $key === $current_product_key ? 'selected' : ''; ?>>
                                    <?php echo t($product['name_key']); ?>
                                </option>
                            <?php endforeach; ?>
                        </select>
                    </div>
                </form>
                
                <hr style="border-color: var(--border); margin: 25px 0;">

                <form method="post" action="?page=admin&section=products&product_key=<?php echo $current_product_key; ?>">
                    <input type="hidden" name="product_key" value="<?php echo $current_product_key; ?>">
                    <div class="admin-form dual-lang">
                        <div class="form-group">
                            <label><?php echo t('admin_products_features_vi'); ?></label>
                            <input type="text" name="feature_vi_1" placeholder="<?php echo t('admin_products_feature_1'); ?>" value="<?php echo htmlspecialchars($current_features['vi'][0] ?? ''); ?>">
                            <input type="text" name="feature_vi_2" placeholder="<?php echo t('admin_products_feature_2'); ?>" value="<?php echo htmlspecialchars($current_features['vi'][1] ?? ''); ?>" style="margin-top: 10px;">
                            <input type="text" name="feature_vi_3" placeholder="<?php echo t('admin_products_feature_3'); ?>" value="<?php echo htmlspecialchars($current_features['vi'][2] ?? ''); ?>" style="margin-top: 10px;">
                            <input type="text" name="feature_vi_4" placeholder="<?php echo t('admin_products_feature_4'); ?>" value="<?php echo htmlspecialchars($current_features['vi'][3] ?? ''); ?>" style="margin-top: 10px;">
                        </div>
                        <div class="form-group">
                            <label><?php echo t('admin_products_features_en'); ?></label>
                            <input type="text" name="feature_en_1" placeholder="<?php echo t('admin_products_feature_1'); ?>" value="<?php echo htmlspecialchars($current_features['en'][0] ?? ''); ?>">
                            <input type="text" name="feature_en_2" placeholder="<?php echo t('admin_products_feature_2'); ?>" value="<?php echo htmlspecialchars($current_features['en'][1] ?? ''); ?>" style="margin-top: 10px;">
                            <input type="text" name="feature_en_3" placeholder="<?php echo t('admin_products_feature_3'); ?>" value="<?php echo htmlspecialchars($current_features['en'][2] ?? ''); ?>" style="margin-top: 10px;">
                            <input type="text" name="feature_en_4" placeholder="<?php echo t('admin_products_feature_4'); ?>" value="<?php echo htmlspecialchars($current_features['en'][3] ?? ''); ?>" style="margin-top: 10px;">
                        </div>
                    </div>
                    <input type="submit" name="save_features" value="<?php echo t('admin_products_save'); ?>" style="margin-top: 20px;">
                </form>
            </section>
            <?php endif; ?>

            <?php if ($section === 'files'): 
                $files_tab = isset($_GET['tab']) ? $_GET['tab'] : 'upload';
            ?>
            <section id="files">
                <div class="tabs">
                    <a href="?page=admin&section=files&tab=upload" class="tab-link <?php echo $files_tab === 'upload' ? 'active' : ''; ?>"><?php echo t('admin_files_upload_header'); ?></a>
                    <a href="?page=admin&section=files&tab=manage" class="tab-link <?php echo $files_tab === 'manage' ? 'active' : ''; ?>"><?php echo t('admin_files_manage_header'); ?></a>
                </div>

                <div id="upload-tab" class="tab-content <?php echo $files_tab === 'upload' ? 'active' : ''; ?>">
                    <div class="admin-box">
                        <form method="post" enctype="multipart/form-data" class="admin-form" action="?page=admin&section=files&tab=upload">
                            <div class="form-group">
                                <label for="product_type"><?php echo t('admin_files_upload_product'); ?></label>
                                <select name="product_type" id="product_type" required>
                                    <option value="">-- <?php echo t('admin_files_upload_product_placeholder'); ?> --</option>
                                    <?php foreach ($products as $key => $product): ?>
                                        <option value="<?php echo $key; ?>"><?php echo t($product['name_key']); ?></option>
                                    <?php endforeach; ?>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="fileToUpload"><?php echo t('admin_files_upload_file'); ?></label>
                                <input type="file" name="fileToUpload" id="fileToUpload" required>
                            </div>
                            <input type="submit" value="<?php echo t('admin_files_upload_button'); ?>" name="submit">
                        </form>
                    </div>
                </div>

                <div id="manage-tab" class="tab-content <?php echo $files_tab === 'manage' ? 'active' : ''; ?>">
                    <div class="products-container">
                        <?php foreach ($products as $key => $product): ?>
                            <div class="product-section">
                                <h3 class="product-title">
                                    <i class="fas fa-folder-open"></i>
                                    <?php echo t($product['name_key']); ?>
                                </h3>
                                <ul class="file-list">
                                    <?php
                                    if (file_exists($product['dir']) && is_dir($product['dir'])) {
                                        $files = array_diff(scandir($product['dir']), array('.', '..'));
                                        if (count($files) > 0) {
                                            foreach ($files as $file) {
                                                echo '<li class="file-item" data-file-id="' . htmlspecialchars($file) . '">';
                                                echo '<a href="' . $product['dir'] . htmlspecialchars($file) . '" target="_blank">';
                                                echo '<i class="fas fa-file-download"></i> ' . htmlspecialchars($file);
                                                echo '</a>';
                                                echo '<span class="delete-btn ajax-delete" 
                                                            data-delete-url="?page=admin&section=files&tab=manage&delete=' . urlencode($file) . '&product=' . $key . '&ajax=1"
                                                            title="Xóa file">
                                                            <i class="fas fa-trash-alt"></i>
                                                      </span>';
                                                echo '</li>';
                                            }
                                        } else {
                                            echo '<li class="empty-state"><i class="fas fa-inbox"></i> ' . t('admin_files_empty') . '</li>';
                                        }
                                    } else {
                                        echo '<li class="empty-state">' . t('admin_files_dir_error') . '</li>';
                                    }
                                    ?>
                                </ul>
                            </div>
                        <?php endforeach; ?>
                    </div>
                </div>
            </section>
            <?php endif; ?>
            
            <?php if ($section === 'settings'): ?>
            <section class="admin-box" id="settings">
                <form method="post" class="admin-form" action="?page=admin&section=settings">
                    <div class="form-group">
                        <label for="contact_link"><?php echo t('admin_settings_contact_link'); ?></label>
                        <input type="text" name="contact_link" id="contact_link" value="<?php echo htmlspecialchars($config['contact_link']); ?>" placeholder="<?php echo t('admin_settings_contact_link_placeholder'); ?>">
                    </div>
                    <input type="submit" name="save_settings" value="<?php echo t('admin_settings_save'); ?>">
                </form>
            </section>
            <?php endif; ?>

        </main>
    </div>
    
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const toggleBtn = document.getElementById('sidebar-toggle');
            if (toggleBtn) {
                toggleBtn.addEventListener('click', () => {
                    document.body.classList.toggle('sidebar-collapsed');
                });
            }

            function showAdminMessage(message, type = 'success') {
                const container = document.getElementById('dynamic-admin-message');
                const messageDiv = document.createElement('div');
                messageDiv.className = `message ${type}`;
                messageDiv.innerHTML = message;
                container.innerHTML = ''; 
                container.appendChild(messageDiv);
                
                setTimeout(() => {
                    messageDiv.style.transition = 'opacity 0.5s';
                    messageDiv.style.opacity = '0';
                    setTimeout(() => container.innerHTML = '', 500);
                }, 3000);
            }

            document.querySelectorAll('.ajax-delete').forEach(button => {
                button.addEventListener('click', e => {
                    e.preventDefault();
                    const url = e.currentTarget.dataset.deleteUrl;
                    const confirmText = '<?php echo t('admin_files_delete_confirm'); ?>';
                    
                    if (confirm(confirmText)) {
                        fetch(url)
                            .then(response => response.json())
                            .then(data => {
                                if (data.status === 'success') {
                                    e.currentTarget.closest('li.file-item').remove();
                                    showAdminMessage(data.message, 'success');
                                } else {
                                    showAdminMessage(data.message || 'Unknown error', 'error');
                                }
                            })
                            .catch(err => {
                                showAdminMessage('Request failed: ' + err, 'error');
                            });
                    }
                });
            });
        });
    </script>
</body>
</html>
<?php
}

function display_main_site($product_details = [], $admin_products = [], $announcement_file = '', $config = [], $features_data = []) {
    
    $active_product_key = (isset($_GET['product']) && isset($product_details[$_GET['product']])) ? $_GET['product'] : 'aimbot_safe';
    $active_product_data = $product_details[$active_product_key];
    
    $announcement_data = ['status' => 'off', 'content' => '', 'image_url' => ''];
    if (file_exists($announcement_file)) {
        $announcement_data = json_decode(file_get_contents($announcement_file), true);
    }
    
    display_page_header(t('main_title'));
?>
    <style>
        :root {
            --background: #0d1117; --surface: #161b22; --surface-light: #21262d;
            --primary: #00aaff; --text: #c9d1d9; --text-secondary: #8b949e;
            --border: #30363d; --green: #28a745; --red: #cf6679;
        }
        body { font-family: 'Be Vietnam Pro', sans-serif; background-color: var(--background); color: var(--text); margin: 0; padding: 0; overflow-x: hidden; position: relative; min-height: 100vh; }
        .star { position: fixed; width: 2px; height: 2px; background: #fff; border-radius: 50%; opacity: 0.7; animation-name: fall; animation-timing-function: linear; animation-iteration-count: infinite; z-index: -1; top: -10px; }
        @keyframes fall { to { transform: translateY(110vh) rotate(360deg); opacity: 0; } }
        .container { max-width: 1100px; margin: 0 auto; padding: 0 20px; }
        .header { padding: 15px 0; background-color: rgba(13, 17, 23, 0.8); backdrop-filter: blur(5px); border-bottom: 1px solid var(--border); position: sticky; top: 0; z-index: 100; }
        .header .container { display: flex; justify-content: space-between; align-items: center; }
        .logo { font-size: 1.8rem; font-weight: 700; color: var(--primary); text-decoration: none; }
        .logo span { font-size: 0.8rem; color: var(--text-secondary); display: block; font-weight: 300; margin-top: -5px; }
        .user-info { text-align: right; font-size: 0.9rem; }
        .user-info .time { color: var(--text-secondary); }
        .user-info .email { color: var(--text); font-weight: 500; }
        .user-info .name { color: var(--text-secondary); }
        .nav { background-color: var(--surface); padding: 10px 0; border-bottom: 1px solid var(--border); box-shadow: 0 4px 12px rgba(0,0,0,0.2); }
        .nav .container { display: flex; justify-content: center; gap: 10px; flex-wrap: wrap; }
        .nav-item { text-decoration: none; color: var(--text-secondary); background-color: var(--surface-light); padding: 10px 25px; border-radius: 8px; font-weight: 500; transition: all 0.3s ease; border: 1px solid var(--border); }
        .nav-item:hover { color: #fff; background-color: #30363d; }
        .nav-item.active { color: #fff; background-color: var(--primary); border-color: var(--primary); box-shadow: 0 0 15px rgba(0, 170, 255, 0.4); }
        .main-content { padding: 30px 0; }
        .product-box { background-color: var(--surface); border-radius: 12px; border: 1px solid var(--border); padding: 30px; margin-bottom: 25px; box-shadow: 0 8px 24px rgba(0,0,0,0.3); }
        .product-title { font-size: 2.5rem; font-weight: 700; color: #fff; margin: 0 0 5px 0; }
        .product-description { font-size: 1.1rem; color: var(--text-secondary); }
        .details-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 25px; }
        .details-box { background-color: var(--surface-light); border-radius: 10px; padding: 25px; border: 1px solid var(--border); min-height: 250px; }
        .details-box h3 { font-size: 1.5rem; color: var(--primary); margin-top: 0; margin-bottom: 20px; border-bottom: 1px solid var(--border); padding-bottom: 10px; }
        .features-list { list-style: none; padding: 0; }
        .features-list li { color: var(--text); margin-bottom: 12px; display: flex; align-items: center; font-weight: 500; }
        .features-list li::before { content: '•'; color: var(--primary); font-weight: 700; font-size: 1.5rem; margin-right: 10px; line-height: 1; }
        .pricing-table { width: 100%; border-collapse: collapse; }
        .pricing-table th, .pricing-table td { padding: 12px 10px; text-align: left; border-bottom: 1px solid var(--border); }
        .pricing-table th { color: var(--text-secondary); font-size: 0.9rem; text-transform: uppercase; }
        .price-name { font-weight: 500; color: var(--text); }
        .price-tag { font-weight: 700; color: #fff; background-color: var(--primary); padding: 5px 12px; border-radius: 6px; font-size: 1rem; }
        .price-tag.free { background-color: var(--green); }
        .download-section { margin-top: 20px; padding-top: 20px; border-top: 1px solid var(--border); }
        .download-section h4 { margin-top: 0; margin-bottom: 15px; color: var(--text); }
        .download-links-container { display: flex; flex-direction: column; gap: 10px; }
        .download-btn, .contact-btn-small {
            display: block; text-decoration: none; background-color: var(--primary); color: #fff;
            padding: 12px 15px; border-radius: 6px; font-weight: 600; font-size: 1rem;
            text-align: center; transition: all 0.3s; cursor: pointer;
        }
        .download-btn:hover { background-color: #0088cc; transform: translateY(-2px); }
        .contact-btn-small { background-color: var(--green); }
        .contact-btn-small:hover { background-color: #2b9a40; }
        .contact-box { text-align: center; }
        .contact-box p { font-size: 1.1rem; color: var(--text-secondary); margin-bottom: 20px; }
        .btn-contact { text-decoration: none; background-color: var(--primary); color: #fff; padding: 14px 40px; border-radius: 8px; font-weight: 700; font-size: 1.1rem; display: inline-block; transition: all 0.3s ease; }
        .btn-contact:hover { background-color: #0088cc; transform: translateY(-2px); box-shadow: 0 6px 20px rgba(0, 170, 255, 0.3); }
        .footer { text-align: center; padding: 30px 20px; border-top: 1px solid var(--border); background-color: var(--surface); color: var(--text-secondary); font-size: 0.9rem; margin-top: 40px; }
        .footer p { margin: 5px 0; }
        .footer a { color: var(--primary); text-decoration: none; }
        .footer a:hover { text-decoration: underline; }
        
        .modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.7); backdrop-filter: blur(5px);
            z-index: 1000; display: none; align-items: center; justify-content: center;
        }
        .modal-box {
            background: var(--surface); border: 1px solid var(--border);
            border-radius: 12px; padding: 30px; max-width: 500px;
            width: 90%; box-shadow: 0 10px 40px rgba(0,0,0,0.5);
            position: relative; animation: modal-fade-in 0.3s ease-out;
        }
        @keyframes modal-fade-in {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .modal-close-x {
            position: absolute; top: 10px; right: 10px;
            background: var(--surface-light); color: var(--text);
            border: 1px solid var(--border); border-radius: 50%;
            width: 30px; height: 30px; font-size: 1rem;
            cursor: pointer; transition: all 0.2s;
        }
        .modal-close-x:hover { background: var(--border); color: #fff; }
        .modal-content img { max-width: 100%; border-radius: 8px; margin-bottom: 15px; }
        .modal-content .modal-text {
            font-size: 1rem; color: var(--text);
            line-height: 1.6; max-height: 300px; overflow-y: auto;
        }
        .modal-actions { margin-top: 25px; display: flex; gap: 10px; justify-content: flex-end; }
        .modal-btn { padding: 10px 20px; border: none; border-radius: 6px; font-weight: 600; cursor: pointer; transition: all 0.3s; text-decoration: none; font-size: 0.9rem;}
        .modal-btn.dismiss { background-color: var(--surface-light); color: var(--text); border: 1px solid var(--border); }
        .modal-btn.dismiss:hover { background-color: var(--border); }
        .modal-btn.confirm { background-color: var(--primary); color: #fff; }
        .modal-btn.confirm:hover { background-color: #0088cc; }
        .modal-btn.cancel { background-color: var(--red); color: #fff; }
        .modal-btn.cancel:hover { background-color: #b04f5f; }

        .modal-note {
            color: var(--primary);
            font-size: 0.9rem;
            text-align: center;
            margin-top: 15px;
            font-style: italic;
        }

        @media (max-width: 768px) {
            .details-grid { grid-template-columns: 1fr; }
            .header .container { flex-direction: column; gap: 10px; }
            .user-info { text-align: center; }
            .nav .container { justify-content: flex-start; overflow-x: auto; flex-wrap: nowrap; padding: 0 20px 10px 20px; }
            .product-title { font-size: 2rem; }
            .details-box { min-height: auto; }
            .lang-switcher { top: 10px; right: 10px; }
            .header .container { padding-top: 40px; } 
        }
    </style>
</head>
<body>
    <audio id="bg-music" src="https://files.catbox.moe/q8qx1u.mp3" loop autoplay></audio>

    <?php for($i=0; $i<80; $i++) { echo '<div class="star" style="left:'.rand(0,100).'%; animation-duration:'.rand(8,15).'s; animation-delay:'.rand(0,10).'s;"></div>'; } ?>

    <header class="header">
        <div class="container">
            <a href="?" class="logo">
                <?php echo t('main_title'); ?>
                <span><?php echo t('main_subtitle'); ?></span>
            </a>
            <div class="user-info">
                <div class="time" id="time-display">...</div>
                <div class="email"><?php echo t('email_contact'); ?></div>
                <div class="name"><?php echo t('user_name'); ?></div>
            </div>
        </div>
    </header>

    <nav class="nav">
        <div class="container">
            <?php
            foreach ($product_details as $key => $product) {
                $class = ($key === $active_product_key) ? 'nav-item active' : 'nav-item';
                echo '<a href="?page=home&product=' . $key . (isset($_GET['lang']) ? '&lang='.$_GET['lang'] : '') . '" class="' . $class . '">' . t($product['nav_key']) . '</a>';
            }
            ?>
        </div>
    </nav>

    <main class="main-content">
        <div class="container">
            <div class="product-box">
                <h1 class="product-title"><?php echo t($active_product_data['title_key']); ?></h1>
                <p class="product-description"><?php echo t($active_product_data['description_key']); ?></p>
            </div>

            <div class="details-grid">
                <div class="details-box">
                    <h3><?php echo t('product_features'); ?></h3>
                    <ul class="features-list">
                        <?php
                        $current_features = $features_data[$active_product_key] ?? ['vi' => [], 'en' => []];
                        $lang_key = get_current_lang(); 
                        $features_to_display = $current_features[$lang_key] ?? $current_features['vi'];
                        
                        foreach ($features_to_display as $feature_text) {
                            if (!empty($feature_text)) {
                                echo '<li>' . htmlspecialchars($feature_text) . '</li>';
                            }
                        }
                        ?>
                    </ul>
                </div>

                <div class="details-box">
                    <h3><?php echo t('product_pricing'); ?></h3>
                    <table class="pricing-table">
                        <thead>
                            <tr>
                                <th><?php echo t('product_pricing_table_header_package'); ?></th>
                                <th><?php echo t('product_pricing_table_header_price'); ?></th>
                            </tr>
                        </thead>
                        <tbody>
                        <?php
                        foreach ($active_product_data['pricing'] as $price_item) {
                            $price_text = (strtolower($price_item['price']) === 'miễn phí' || strtolower($price_item['price']) === 'free') 
                                ? 'Miễn phí' : $price_item['price'];
                            $price_class = (strtolower($price_item['price']) === 'miễn phí') ? 'price-tag free' : 'price-tag';
                            
                            echo '<tr>';
                            echo '<td class="price-name">' . t($price_item['name_key']) . '</td>';
                            echo '<td><span class="' . $price_class . '">' . $price_text . '</span></td>';
                            echo '</tr>';
                        }
                        ?>
                        </tbody>
                    </table>
                    
                    <div class="download-section">
                        <h4><?php echo t('product_download_header'); ?></h4>
                        <div class="download-links-container">
                        <?php
                        $dir_key = $active_product_key;
                        $dir_path = $admin_products[$dir_key]['dir'] ?? 'uploads/default/';
                        $files = [];
                        if (file_exists($dir_path) && is_dir($dir_path)) {
                            $files = array_diff(scandir($dir_path), array('.', '..'));
                        }
                        
                        if (count($files) > 0) {
                            $file_index = 1;
                            foreach ($files as $file) {
                                $file_path = $dir_path . htmlspecialchars($file);
                                $product_name_for_modal = htmlspecialchars(t($active_product_data['title_key']));
                                echo '<a href="#" class="download-btn download-trigger" 
                                        data-href="' . $file_path . '" 
                                        data-product-name="' . $product_name_for_modal . '">';
                                echo '<i class="fa fa-download"></i> ' . t('product_download_button', $file_index);
                                echo '</a>';
                                $file_index++;
                            }
                        } else {
                            echo '<a href="' . htmlspecialchars($config['contact_link']) . '" class="contact-btn-small" target="_blank">' . t('product_download_contact') . '</a>';
                        }
                        ?>
                        </div>
                    </div>
                </div>
            </div>

            <div class="product-box contact-box" style="margin-top: 25px;">
                <p><?php echo t('product_contact_prompt'); ?></p>
                <a href="<?php echo htmlspecialchars($config['contact_link']); ?>" class="btn-contact" target="_blank"><?php echo t('product_contact_button'); ?></a>
            </div>
        </div>
    </main>

    <footer class="footer">
        <p><?php echo t('copyright', date("Y")); ?></p>
        <p>Contact: <a href="mailto:<?php echo t('email_contact'); ?>"><?php echo t('email_contact'); ?></a> | <a href="?page=login"><?php echo t('admin_panel'); ?></a></p>
        <p style="color: #444; font-size: 0.8rem; margin-top: 20px; opacity: 0.7;"><?php echo t('activate_windows'); ?></p>
    </footer>

    <?php if ($announcement_data['status'] === 'on'): ?>
    <div id="modal-overlay-announcement" class="modal-overlay">
        <div class="modal-box">
            <button id="modal-close-x" class="modal-close-x" title="<?php echo t('modal_close'); ?>">&times;</button>
            <div id="modal-content" class="modal-content">
                <?php if (!empty($announcement_data['image_url'])): ?>
                    <img src="<?php echo htmlspecialchars($announcement_data['image_url']); ?>" alt="Announcement">
                <?php endif; ?>
                <div class="modal-text">
                    <?php echo $announcement_data['content']; ?>
                </div>
            </div>
            <div class="modal-actions">
                <button id="modal-dismiss-2h" class="modal-btn dismiss"><?php echo t('modal_dismiss_2h'); ?></button>
            </div>
        </div>
    </div>
    <?php endif; ?>
    
    <div id="modal-overlay-download" class="modal-overlay">
        <div class="modal-box">
            <h3 style="color: var(--primary); margin-top:0;"><?php echo t('confirm_download_title'); ?></h3>
            <div class="modal-content">
                <p><?php echo t('confirm_download_body'); ?>
                    <br>
                    <strong id="download-product-name" style="color: var(--text); font-size: 1.1rem;"></strong>
                </p>
                <p class="modal-note"><?php echo t('confirm_download_note'); ?></p>
            </div>
            <div class="modal-actions">
                <button id="modal-btn-cancel" class="modal-btn cancel"><?php echo t('confirm_download_cancel'); ?></button>
                <a href="#" id="modal-btn-confirm" class="modal-btn confirm" download><?php echo t('confirm_download_yes'); ?></a>
            </div>
        </div>
    </div>

    <script>
        function updateTime() {
            const now = new Date();
            const options = { 
                year: 'numeric', month: '2-digit', day: '2-digit', 
                hour: '2-digit', minute: '2-digit', second: '2-digit', 
                hour12: false, timeZone: 'Asia/Ho_Chi_Minh' 
            };
            const formatter = new Intl.DateTimeFormat('en-GB', options);
            const parts = formatter.formatToParts(now);
            let dateParts = {};
            parts.forEach(part => dateParts[part.type] = part.value);
            const timeString = `${dateParts.hour}:${dateParts.minute}:${dateParts.second}`;
            const dateString = `${dateParts.day}/${dateParts.month}/${dateParts.year}`;
            document.getElementById('time-display').innerText = `${timeString} - ${dateString}`;
        }
        updateTime();
        setInterval(updateTime, 1000);
        
        document.addEventListener('DOMContentLoaded', () => {
            const music = document.getElementById('bg-music');
            if(music) {
                const musicTimeKey = 'bgMusicTime';
                
                const savedTime = localStorage.getItem(musicTimeKey);
                if (savedTime) {
                    music.currentTime = parseFloat(savedTime);
                }

                var promise = music.play();
                if (promise !== undefined) {
                    promise.catch(error => {
                        document.body.addEventListener('click', () => music.play(), { once: true });
                    });
                }

                window.addEventListener('beforeunload', () => {
                    localStorage.setItem(musicTimeKey, music.currentTime);
                });
            }

            const annOverlay = document.getElementById('modal-overlay-announcement');
            const annCloseBtn = document.getElementById('modal-close-x');
            const annDismissBtn = document.getElementById('modal-dismiss-2h');
            
            if (annOverlay) {
                const dismissKey = 'dismissAnnouncement';
                const lastDismissTime = localStorage.getItem(dismissKey);
                
                if (!lastDismissTime || (Date.now() - lastDismissTime > 7200000)) { 
                    annOverlay.style.display = 'flex';
                }

                function closeAnnModal() { annOverlay.style.display = 'none'; }
                
                if (annCloseBtn) annCloseBtn.addEventListener('click', closeAnnModal);
                annOverlay.addEventListener('click', (e) => { if (e.target === annOverlay) closeAnnModal(); });
                if (annDismissBtn) annDismissBtn.addEventListener('click', () => {
                    localStorage.setItem(dismissKey, Date.now());
                    closeAnnModal();
                });
            }

            const dlOverlay = document.getElementById('modal-overlay-download');
            const dlTriggers = document.querySelectorAll('.download-trigger');
            const dlConfirmBtn = document.getElementById('modal-btn-confirm');
            const dlCancelBtn = document.getElementById('modal-btn-cancel');

            if (dlOverlay) {
                function closeDlModal() { dlOverlay.style.display = 'none'; }
                
                dlTriggers.forEach(trigger => {
                    trigger.addEventListener('click', (e) => {
                        e.preventDefault();
                        const filePath = trigger.getAttribute('data-href');
                        const productName = trigger.getAttribute('data-product-name');
                        
                        dlConfirmBtn.href = filePath;
                        document.getElementById('download-product-name').innerText = productName;
                        
                        dlOverlay.style.display = 'flex';
                    });
                });
                
                dlCancelBtn.addEventListener('click', closeDlModal);
                dlOverlay.addEventListener('click', (e) => { if (e.target === dlOverlay) closeDlModal(); });
                dlConfirmBtn.addEventListener('click', closeDlModal);
            }
        });
    </script>
</body>
</html>
<?php
}

switch ($page) {
    case 'login':
        display_login_page($login_error ?? '');
        break;
    case 'admin':
        display_admin_page($admin_message ?? '', $PRODUCTS, $ANNOUNCEMENT_FILE, $config, $features_data);
        break;
    default:
        display_main_site($PRODUCT_DETAILS, $PRODUCTS, $ANNOUNCEMENT_FILE, $config, $features_data);
        break;
}
?>
